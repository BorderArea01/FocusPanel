<Window x:Class="FocusPanel.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:local="clr-namespace:FocusPanel.Views"
        xmlns:vm="clr-namespace:FocusPanel.ViewModels"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        ShowInTaskbar="False"
        ResizeMode="CanResizeWithGrip"
        FontFamily="{DynamicResource MaterialDesignFont}"
        Title="{Binding Title}" Height="600" Width="300"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary>
                    <DataTemplate DataType="{x:Type vm:DashboardViewModel}">
                        <local:DashboardView />
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type vm:TasksViewModel}">
                        <local:TasksView />
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type vm:PomodoroViewModel}">
                        <local:PomodoroView />
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type vm:FileOrganizerViewModel}">
                        <local:FileOrganizerView />
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type vm:AIAssistantViewModel}">
                        <local:AIAssistantView />
                    </DataTemplate>
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <!-- Taskbar Icon -->
        <tb:TaskbarIcon x:Name="MyNotifyIcon"
                        ToolTipText="FocusPanel"
                        MenuActivation="LeftOrRightClick"
                        DoubleClickCommand="{Binding ShowWindowCommand}">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Show FocusPanel" Command="{Binding ShowWindowCommand}" />
                    <MenuItem Header="Exit" Command="{Binding CloseAppCommand}" />
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <!-- Desktop Layer -->
        <Grid>
             <!-- Center Widget Area (Clock) -->
             <Grid VerticalAlignment="Top" HorizontalAlignment="Center" Margin="0,100,0,0">
                  <StackPanel HorizontalAlignment="Center">
                      <TextBlock Text="{Binding CurrentTime, StringFormat={}{0:HH:mm}}" 
                                FontSize="96" FontWeight="Light" Foreground="White" 
                                Effect="{DynamicResource MaterialDesignShadowDepth2}" HorizontalAlignment="Center" />
                      <TextBlock Text="{Binding CurrentTime, StringFormat={}{0:D}}" 
                                 FontSize="24" Foreground="White" Opacity="0.8" 
                                 Effect="{DynamicResource MaterialDesignShadowDepth1}" HorizontalAlignment="Center" Margin="0,-10,0,0"/>
                  </StackPanel>
             </Grid>

             <!-- Right Sidebar Dock -->
             <Border x:Name="SidebarBorder" Width="80" HorizontalAlignment="Right"
                    Background="{DynamicResource MaterialDesignPaper}" 
                    Margin="0,20,0,20" 
                    CornerRadius="16,0,0,16" 
                    Effect="{DynamicResource MaterialDesignShadowDepth4}"
                    BorderBrush="{DynamicResource MaterialDesignDivider}"
                    BorderThickness="1,1,0,1"
                    ClipToBounds="True"
                    MouseEnter="Sidebar_MouseEnter"
                    MouseLeave="Sidebar_MouseLeave"
                    IsKeyboardFocusWithinChanged="Sidebar_IsKeyboardFocusWithinChanged">
 
                 <Border.OpacityMask>
                    <VisualBrush>
                        <VisualBrush.Visual>
                            <Border Background="Black" SnapsToDevicePixels="True"
                                    CornerRadius="{Binding CornerRadius, RelativeSource={RelativeSource AncestorType=Border}}"
                                    Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Border}}"
                                    Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Border}}" />
                        </VisualBrush.Visual>
                    </VisualBrush>
                </Border.OpacityMask>
                
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header / Drag Area -->
                    <Grid x:Name="HeaderGrid" Grid.Row="0" Margin="20,15,15,10" Opacity="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                             <materialDesign:PackIcon Kind="ViewDashboardOutline" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                             <TextBlock Text="FocusPanel" FontWeight="SemiBold" FontSize="16" VerticalAlignment="Center" Foreground="{DynamicResource MaterialDesignBody}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Style="{StaticResource MaterialDesignIconForegroundButton}" Command="{Binding MinimizeAppCommand}" ToolTip="Minimize" Height="30" Width="30">
                                <materialDesign:PackIcon Kind="WindowMinimize" Width="18" Height="18"/>
                            </Button>
                            <Button Style="{StaticResource MaterialDesignIconForegroundButton}" Command="{Binding CloseAppCommand}" ToolTip="Close" Height="30" Width="30" Margin="5,0,0,0">
                                <materialDesign:PackIcon Kind="Close" Width="18" Height="18"/>
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- Main Layout -->
                    <Grid Grid.Row="1" Margin="0,10,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Mini Navigation Rail -->
                        <Border Grid.Column="0" Margin="15,0,0,15" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="20" Padding="6" VerticalAlignment="Center" Effect="{DynamicResource MaterialDesignShadowDepth1}">
                            <StackPanel>
                                <Button Command="{Binding NavigateCommand}" CommandParameter="Dashboard" Style="{StaticResource MaterialDesignFlatButton}" ToolTip="Dashboard" Padding="10" Margin="0,4" Height="Auto" materialDesign:ButtonAssist.CornerRadius="16">
                                    <materialDesign:PackIcon Kind="ViewDashboard" Width="24" Height="24"/>
                                </Button>
                                <Button Command="{Binding NavigateCommand}" CommandParameter="Tasks" Style="{StaticResource MaterialDesignFlatButton}" ToolTip="Tasks" Padding="10" Margin="0,4" Height="Auto" materialDesign:ButtonAssist.CornerRadius="16">
                                    <materialDesign:PackIcon Kind="CheckboxMarked" Width="24" Height="24"/>
                                </Button>
                                <Button Command="{Binding NavigateCommand}" CommandParameter="Pomodoro" Style="{StaticResource MaterialDesignFlatButton}" ToolTip="Pomodoro" Padding="10" Margin="0,4" Height="Auto" materialDesign:ButtonAssist.CornerRadius="16">
                                    <materialDesign:PackIcon Kind="Timer" Width="24" Height="24"/>
                                </Button>
                                <Button Command="{Binding NavigateCommand}" CommandParameter="Files" Style="{StaticResource MaterialDesignFlatButton}" ToolTip="Files" Padding="10" Margin="0,4" Height="Auto" materialDesign:ButtonAssist.CornerRadius="16">
                                    <materialDesign:PackIcon Kind="Folder" Width="24" Height="24"/>
                                </Button>
                                <Button Command="{Binding NavigateCommand}" CommandParameter="AI" Style="{StaticResource MaterialDesignFlatButton}" ToolTip="AI Assistant" Padding="10" Margin="0,4" Height="Auto" materialDesign:ButtonAssist.CornerRadius="16">
                                    <materialDesign:PackIcon Kind="Robot" Width="24" Height="24"/>
                                </Button>
                            </StackPanel>
                        </Border>

                        <!-- Content Area -->
                        <Border x:Name="ContentArea" Grid.Column="1" Margin="15,0,15,15" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="12" Padding="15" Opacity="0">
                             <ContentControl Content="{Binding CurrentViewModel}"/>
                        </Border>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
